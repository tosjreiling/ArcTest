#!/usr/bin/env php
<?php

use ArcTest\ArcTest;
use ArcTest\Enum\PrintFormat;

require_once __DIR__ . '/../vendor/autoload.php';

$args = getopt("", ["path::", "verbose", "fail-fast", "format::", "filter::"]);
$path = $args["path"] ?? (__DIR__ . "/../tests");
$verbose = isset($args["verbose"]);
$failFast = isset($args["fail-fast"]);
$formatValue = $args["format"] ?? "console";
$filter = $args["filter"] ?? "";

try {
    $format = PrintFormat::from($formatValue);
} catch (ValueError $e) {
    echo "Invalid format: '{$formatValue}'. Allowed values: ";
    echo implode(", ", array_map(fn($f) => $f->value, PrintFormat::cases())) . PHP_EOL;
    exit(1);
}

$exitCode = ArcTest::run($path, $verbose, $failFast, $format, $filter);
exit($exitCode);
